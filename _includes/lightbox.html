<!-- Lightbox -->
<div class="lb" id="lb" aria-hidden="true">
    <div class="lbCard" role="dialog" aria-label="Pregled slike">
        <div class="lbBar">
            <div class="lbTag" id="lbCap">Screenshot</div>
            <div class="lbBtns">
                <button class="lbBtn" id="lbPrev" title="Prethodna">←</button>
                <button class="lbBtn" id="lbNext" title="Sljedeća">→</button>
                <button class="lbBtn" id="lbClose" title="Zatvori">✕</button>
            </div>
        </div>
        <img class="lbImg" id="lbImg" src="" alt="" />
    </div>
</div>

<script>
  (function(){
    const supportsWebp = (() => {
      try {
        const c = document.createElement('canvas');
        if (!c.getContext) return false;
        return c.toDataURL('image/webp').indexOf('data:image/webp') === 0;
      } catch(e){
        return false;
      }
    })();

    const shots = Array.from(document.querySelectorAll('.shot'));
    const lb = document.getElementById('lb');
    const lbImg = document.getElementById('lbImg');
    const lbCap = document.getElementById('lbCap');
    const btnClose = document.getElementById('lbClose');
    const btnPrev = document.getElementById('lbPrev');
    const btnNext = document.getElementById('lbNext');

    let idx = 0;

    function openAt(i){
      idx = Math.max(0, Math.min(shots.length - 1, i));
      const el = shots[idx];
      lbImg.src = (supportsWebp && el.dataset.srcWebp) ? el.dataset.srcWebp : el.dataset.src;
      lbImg.alt = el.dataset.cap || ('Screenshot ' + (idx+1));
      lbCap.textContent = el.dataset.cap || ('Screenshot ' + (idx+1));
      lb.classList.add('open');
      lb.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }
    function close(){
      lb.classList.remove('open');
      lb.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      lbImg.src = '';
    }
    function prev(){ openAt((idx - 1 + shots.length) % shots.length); }
    function next(){ openAt((idx + 1) % shots.length); }

    shots.forEach((el, i) => el.addEventListener('click', () => openAt(i)));
    btnClose.addEventListener('click', close);
    btnPrev.addEventListener('click', prev);
    btnNext.addEventListener('click', next);

    lb.addEventListener('click', (e) => { if(e.target === lb) close(); });

    window.addEventListener('keydown', (e) => {
      if(!lb.classList.contains('open')) return;
      if(e.key === 'Escape') close();
      if(e.key === 'ArrowLeft') prev();
      if(e.key === 'ArrowRight') next();
    });
  })();
</script>
